{% extends "generic.html" %}

{% block custom_headers %}
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script>
    function newSearchParam(selectValues) {
        let filters = $('.search-filter')
        let selectID;
        if (filters.length > 0) {
            selectID = Math.max(...filters.map(function () { return this.id.slice(14) })) + 1;
        } else {
            selectID = 1;
        }
        console.log("selectID: " + selectID);
        htmlBuilder = `<div class="form-group search-filter search-filter-${selectID}" id="search-filter-${selectID}">`
        let selectHeader = `<select name="resultFilter_${selectID}" class="form-control search-selector search-filter-select search-filter-${selectID}" required="" id="resultFilter_${selectID}">`
        htmlBuilder += selectHeader;
        // console.log(typeof selectedValues);
        selectValues.forEach(value => {
            htmlBuilder += `<option value="${value}">${value}</option>`
        });
        htmlBuilder += `<input type="text" class="form-control search-filter-text search-filter-${selectID}" id="resultfiltervalue_${selectID}" name="resultFilterValue_${selectID}">`
        htmlBuilder += "</select></div>";
        return htmlBuilder;
    }
    // $(document).ready(function () {
    //     $("#txtSearch").autocomplete({
    //         source: "/ajax_calls/search/",
    //         minLength: 2,
    //         open: function () {
    //             setTimeout(function () {
    //                 $('.ui-autocomplete').css('z-index', 99);
    //             }, 0);
    //         }
    //     });
    // });
    $(document).ready(function () {
        $("#actionbutton").click(function () {
            console.log('sucess!');
            $("#buttonresult").append("<p>something</p>");
        }
        );
    });
    $(document).ready(function () {
        $("#actionbutton").on("click", function () {
            $.post("/ajax_calls/easy", {
                'csrfmiddlewaretoken': '{{ csrf_token }}',
                'param1': 'red',
                'param2': 15
            },
                function () {
                    alert('returned!');
                });
        });
    });
    $(document).ready(function () {
        $("#resultTypeSelector").on("change", function () {
            let resultTypeSelector = $("#resultTypeSelector")[0];
            let resultTypeSelected = resultTypeSelector.options[resultTypeSelector.options.selectedIndex].value;
            $.post("/ajax_calls/search_selector", {
                'csrfmiddlewaretoken': '{{ csrf_token }}',
                'resultType': "Artwork",
                'resultType': resultTypeSelected
            },
                function (data) {
                    // console.log(data);
                    let newSelect = newSearchParam(data.fields);
                    $("#search-bar").append(
                        newSelect
                    );
                });
        });
    });
    // $(document).ready(function () {
    //     $("#search-bar").on("change", ".search-filter", function(event) {

    //         let highestChangedIndex = event.target.className.match(/search-filter-[0-9]+/)[0].slice(14);
    //         let activeFilters = $(".search-filter")
    //         // console.log('called');
    //         console.log(event.target);
    //     });
    // });
    // $(document).ready(function () {
    //     $("#search-bar").on("click", ".search-selector", function () {
    //         let resultTypeSelector = $("#resultTypeSelector")[0];
    //         let resultTypeSelected = resultTypeSelector.options[resultTypeSelector.options.selectedIndex].value;
    //         $.post("/ajax_calls/search-selector", {
    //             'csrfmiddlewaretoken': '{{ csrf_token }}',
    //             'resultType': "Artwork",
    //             'resultType': resultTypeSelected
    //         },
    //             function (data) {
    //                 console.log(data);
    //                 let newSelect = newSearchParam(data.fields);
    //                 $("#search-bar").append(
    //                     newSelect
    //                 );
    //             });
    //     });
    // });
    // $(document).ready(function () {
    //     $("#search-bar").on("click", ".search-selector", function () {
    //         $.post("/ajax_calls/easy", {
    //             'csrfmiddlewaretoken': '{{ csrf_token }}',
    //             'model': $("#resultType").options[e.target.selectedIndex].text;
    //         },
    //             function (data) {
    //                 let newSelect = newSearchParam(["banana", "Potato"]);
    //                 $("#search-bar").append(
    //                     newSelect
    //                 );
    //             });
    //     });
    // });
    // $(document).ready(function () {
    //     $("#search-bar").on("click", ".search-selector", function () {
    //         $.post("/ajax_calls/easy", {
    //             'csrfmiddlewaretoken': '{{ csrf_token }}'
    //         },
    //             function (data) {
    //                 let dataOptions = "<option>" + String(data) + "</option>";
    //                 let select_string = "<select class=\"form-control search-selector\"><option>Nada</option>";
    //                 console.log(dataOptions);
    //                 console.log(select_string);
    //                 $("#search-bar").append(
    //                     select_string + dataOptions + "</select>"
    //                     // "<select class=\"form-control search-selector\"><option value=\"1\">1</option><option value=\"2\">2</option></select>"
    //                 );
    //             });
    //     });
    // });

</script>

{% endblock %}

{% block page_name %}
<h3>Search</h3>
{% endblock page_name %}

{% block content %}
<!-- <table>
    <form action="" method='post'>
        {% csrf_token %}
        <th><label for="id_search_type">What are you looking for?</label></th>
        <td><select name="search_type" required id="id_search_type">
                <option value="Artwork" selected>Artwork</option>
                <option value="Series">Series</option>
                <option value="Exhibition">Exhibition</option>
                <option value="Location">Location</option>
            </select></td>
        <td><input type="text" name="search_body" id="id_search_body"></td>
        <td><input type="submit" value="Go"></td>
        </tr>
    </form> -->
</table>
<form id="search" method="POST" action="">
    {% csrf_token %}
    <div id="search-bar" name="Search Bar">

        <div class="form-group">
            <select name="resultType" class="form-control search-selector" required="" id="resultTypeSelector">
                {% for resultType in resultTypes %}
                <option class="form-control" value="{{ resultType }}">{{ resultType }}</option>
                {% endfor %}
            </select>

            <input type="text" class="form-control" id="txtSearch" name="txtSearch">
        </div>
    </div>
    <div class="form-group">
        <button type="submit" class="btn btn-default btn-submit">Submit</button>
    </div>
</form>
<button class="btn" id="actionbutton">Press me!</button>
<div id="buttonresult">intial value</div>
<h3>Get Params</h3>
{{ getParams }}
<h3>Post Params</h3>
{{ postParams }}
{% endblock %}