{% extends "base.html" %}
{% load widget_tweaks %}
{% load static %}

{% block custom_headers %}
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script>

    $(document).ready(function () {
        $(".size-field").each((index, elem) => {
            let value = elem.value;
            if (String(Number(value)) === value) {
                elem.style.width = ((value.length) * 9 + 5) + 'px';
            } else {
                elem.style.width = ((value.length - 2) * 9 + 5) + 'px';
            }

        })
        $('.size-field').on('keyup', (event) => {
            event.target.style.width = ((event.target.value.length) * 9 + 5) + 'px';
        });
    });

</script>
{% endblock custom_headers %}

{% block page_title %}
<!-- {% if form.title.value %}{{ form.title.value }}
{% else %}Artwork{% endif %} -->
{% endblock %}

{% block content %}
<!-- <form action="." method="POST" enctype="multipart/form-data"> -->
{% csrf_token %}
<div class="row" id="artwork-headers">
    {%  render_field form.series class="artwork-header-field" %}
    {%  render_field form.title class="artwork-header-field" %}
    ({%  render_field form.year class="artwork-header-field" %})
    {%  render_field form.status class="artwork-header-field" %}
    <input type="submit" class="btn btn-primary artwork-header-field" value="{{ action_name }}">
</div>
<div class="row" id="artwork-details-wrapper">
    <div class="col-sm-6" id="left-col">
        <div id="artwork-image" class="card">
            {% if form.instance.image %}
            <img class="img-fluid card-img-top" src="{{ form.instance.image.url }}" alt="Artwork image">
            {% else %}
            <img class="img-fluid card-img-top" src="{% static 'catalogue/images/unicorn.png' %}" alt="Artwork image">
            {% endif %}
            <div class="card-body">
                {{ form.image }}
                <!-- {% render_field form.image class="custom-file"%} -->
            </div>
        </div>
        {% if editMode %}
        <div id="sales-info" class="card">
            <div class="card-body sale-form">
                <h3 class='card-title'>Sale Info</h3>
                <table class='table'>
                    <tbody>
                        <tr>
                            <th scope="row">{{ form.owner.label_tag }}</th>
                            <td>
                                {% render_field form.owner class="form-control form-control-sm" %}
                                {% if form.owner.help_text %}
                                <small class="form-text text-muted">{{ form.owner.help_text }}</small>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">{{ form.sold_by.label_tag }}</th>
                            <td>
                                {% render_field form.sold_by class="form-control form-control-sm" %}
                                {% if form.sold_by.help_text %}
                                <small class="form-text text-muted">{{ form.sold_by.help_text }}</small>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">{{ form.price_nis.label_tag }}</th>
                            <td>
                                {% render_field form.price_nis class="form-control form-control-sm" %}
                                {% if form.price_nis.help_text %}
                                <small class="form-text text-muted">{{ form.price_nis.help_text }}</small>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">{{ form.price_usd.label_tag }}</th>
                            <td>
                                {% render_field form.price_usd class="form-control form-control-sm" %}
                                {% if form.price_usd.help_text %}
                                <small class="form-text text-muted">{{ form.price_usd.help_text }}</small>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">{{ form.sale_price.label_tag }}</th>
                            <td id="sale-price-td">
                                {% render_field form.sale_currency class="form-control form-control-sm" id="sale-currency" %}
                                {% render_field form.sale_price class="form-control form-control-sm"  %}
                                {% if form.sale_price.help_text %}
                                <small class="form-text text-muted">{{ form.sale_price.help_text }}</small>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">{{ form.discount.label_tag }}</th>
                            <td>
                                {% render_field form.discount class="form-control form-control-sm" %}
                                {% if form.discount.help_text %}
                                <small class="form-text text-muted">{{ form.discount.help_text }}</small>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">{{ form.sale_date.label_tag }}</th>
                            <td>
                                {% render_field form.sale_date class="form-control form-control-sm" %}
                                {% if form.sale_date.help_text %}
                                <small class="form-text text-muted">{{ form.sale_date.help_text }}</small>
                                {% endif %}
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %}
    </div>
    <div class="col-sm-6" id="right-col">
        <div id="artwork-details" class="card">
            <div class="card-body">
                <div class="size-fields row">
                    <div id="size-fields-measures" class="col-5">
                        <h5>Size (h | w | d):</h5>
                        <div id="size-fields-cm" class="form-inline size-form-group">
                            <div id="id_size_cm" class="size-field-container form-control form-control-sm">
                                {% render_field form.height_cm class="size-field" %}
                                <span class="size-field-separator">|</span>
                                {% render_field form.width_cm class="size-field" %}
                                <span class="size-field-separator">|</span>
                                {% render_field form.depth_cm class="size-field" %}
                            </div>
                            <label for="id_size_cm">cm</label>
                        </div>
                        <div id="size-fields-in" class="form-inline size-form-group">
                            <div id="id_size_in" class="size-field-container form-control form-control-sm">
                                {% render_field form.height_in class="size-field" %}
                                <span class="size-field-separator">|</span>
                                {% render_field form.width_in class="size-field" %}
                                <span class="size-field-separator">|</span>
                                {% render_field form.depth_in class="size-field" %}
                            </div>
                            <label for="id_size_in">in</label>
                        </div>
                    </div>
                    <div id="size-fields-addtl" class="form col-7">
                        <div id="size-fields-type">
                            <!-- <h6></h6> -->
                            <div class="form-group">
                                {{ form.size.label_tag }}
                                {% render_field form.size class="form-control form-control-sm" %}
                                {% if form.size.help_text %}
                                <small class="form-text text-muted">{{ form.size.help_text }}</small>
                                {% endif %}
                            </div>
                        </div>
                        <div id="size-fields-rolled">
                            <div class="form-group">
                                {{ form.rolled.label_tag }}
                                {% render_field form.rolled class="form-control form-control-sm" %}
                                {% if form.rolled.help_text %}
                                <small class="form-text text-muted">{{ form.rolled.help_text }}</small>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group" id="location-field">
                    {{ form.location.label_tag }}
                    {% render_field form.location class="form-control form-control-sm" %}
                    {% if form.location.help_text %}
                    <small class="form-text text-muted">{{ form.location.help_text }}</small>
                    {% endif %}
                </div>
                <div class="form-group" id="medium-field">
                    {{ form.medium.label_tag }}
                    {% render_field form.medium class="form-control form-control-sm" %}
                    {% if form.medium.help_text %}
                    <small class="form-text text-muted">{{ form.medium.help_text }}</small>
                    {% endif %}
                </div>
                <div class="form-group" id="addtl-field">
                    {{ form.additional.label_tag }}
                    {% render_field form.additional class="detail-field form-control form-control-sm" %}
                    {% if form.additional.help_text %}
                    <small class="form-text text-muted">{{ form.additional.help_text }}</small>
                    {% endif %}
                </div>
            </div>
        </div>
        <div id="exhibitions" class="card">

            <h3>All Exhibitions</h3>
            <form action="{% url 'catalogue:add_workinexhibition' %}" method="POST">
                {% csrf_token %}
                {% render_field exhibitionForm.artwork style="visibility:hidden;" %}
                {% render_field exhibitionForm.exhibition %}
                <input type="submit" class="btn btn-primary" value="Add new">
            </form>
            <table>
                <th>Name</th>
                <th>Start date</th>
                <th>End date</th>
                </tr>
                {% for exhibition in exhibitionList %}
                <tr>
                    <td><a href="{% url 'catalogue:exhibition_detail' exhibition.pk %}">{{ exhibition.name }}</a>
                    </td>
                    <td>{{ exhibition.start_date }}</td>
                    <td>{{ exhibition.end_date }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>
    </div>
</div>
<!-- </form> -->
{% endblock content %}

{% block related_items %}
<!-- <div class="row related-content">
    <div class="col-sm-6">

        <div class="row" id="locations-history-container">
            <h2>Locations</h2>
            <p>{{ form.location.value }}</p>
        </div>
    </div>
   
</div> -->
{% endblock %}